---
title: "PRS_EA"
output: html_document
---

# Libraries

```{r}
library(tidyverse)
```

#Test of Time dependency
Variables that are not required for the analysis: "SITE","COLPROT","ORIGPROT","FLDSTRENG","FSVERSION","IMAGEUID", "Month_bl","Month","M","update_stamp".
```{r}
knitr::opts_chunk$set(echo = TRUE)

dat <- read.csv("data/ADNIMERGE.csv")

time_test <- function(data, idvar, tvar) {
  x <- data[, c(idvar, tvar)] %>% arrange(tvar)
  time_dependent <- FALSE
  unique_participants <- unique(x[, 1])
  for (participant in unique_participants) {
    participant_data <- x[x[, 1] == participant, 2]
    if (length(unique(participant_data)) > 1) {
      time_dependent <- TRUE
      break
    }
  }
  if (time_dependent) {
    return(data.frame(variable = tvar, status = "Time Dependent"))
  } else {
    return(data.frame(variable = tvar, status = "Time Independent"))
  }
}

results <- data.frame(variable = character(), status = character(), stringsAsFactors = FALSE)

for (col in 1:length(colnames(dat))) {
  result <- time_test(dat, "RID", colnames(dat)[col])
  results <- rbind(results, result)
}
rm(result)

exclude <- c("SITE","COLPROT","ORIGPROT","FLDSTRENG",
                   "FSVERSION","IMAGEUID", "Month_bl","Month","M",
                   "update_stamp")

ivars <- subset(results, status=="Time Independent") %>% 
  subset(!(variable %in% exclude))

nivars <- subset(results, status=="Time Dependent") %>% 
  subset(!(variable %in% exclude))
```

# Data Format: Long to Wide

```{r}
# Define Variables of Interest & Order
long_dat <- dat[, c(ivars[,1], nivars[,1])] %>%
  relocate(RID, PTID, EXAMDATE,VISCODE) %>%
  arrange(RID, VISCODE) %>%
  rename(DX_bas = DX_bl)

```

#Transform Long to Wide Data Format
Next we transform the data using the pivot_wider function, which requires three 
inputs. First, a variable to create new names from, which is in our case the 
VISCODE variable of length 26. 

```{r}
# From Long to Wide data format
wide_dat <- long_dat %>% pivot_wider(
  
  names_from = VISCODE,
  
  id_cols = ivars[,1],
  
  values_from = nivars[,1],
  
  names_repair = unique
  )
```

```{r}
#Code Island

#Index Column based on label
#grep("RID", colnames(dat))

# How many participants do we have?
#length(unique(dat$RID))

```
