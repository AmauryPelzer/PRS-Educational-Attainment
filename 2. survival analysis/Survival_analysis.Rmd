---
title: "PGS Educational Attainment"
author: Sebastian Marten & Amaury Pelzer
output: rmdformats::robobook
---

```{r, include=FALSE}
if (suppressWarnings(!require(dplyr))) {install.packages("dplyr"); library(dplyr)}
if (suppressWarnings(!require(NormPsy))) {install.packages("NormPsy"); library(NormPsy)}
if (suppressWarnings(!require(gridExtra))) {install.packages("gridExtra"); library(gridExtra)}
if (suppressWarnings(!require(rmdformats))) {install.packages("rmdformats"); library(rmdformats)}
if (suppressWarnings(!require(ggplot2))) {install.packages("ggplot2"); library(ggplot2)}
if (suppressWarnings(!require(survival))) {install.packages("survival"); library(survival)}
if (suppressWarnings(!require(survminer))) {install.packages("survminer"); library(survminer)}
#if (suppressWarnings(!require(tidyverse))) {install.packages("tidyverse"); library(tidyverse)}
#if (suppressWarnings(!require(data.table))) {install.packages("data.table"); library(data.table)}
#if (suppressWarnings(!require(formattable))) {install.packages("formattable"); library(formattable)}
#if (suppressWarnings(!require(ggsurvfit))) {install.packages("ggsurvfit"); library(ggsurvfit)}
#if (suppressWarnings(!require(performance))) {install.packages("performance"); library(performance)}
#if (suppressWarnings(!require(cowplot))) {install.packages("cowplot"); library(cowplot)}
#if (suppressWarnings(!require(nlme))) {install.packages("nlme"); library(nlme)}
```

# Import Data and create functions

```{r, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load in data from preprocessing and apply filter
long_dat <- read.csv("../1.\ preprocessing/output/long_dat.csv")

wide_dat <- read.csv("../1.\ preprocessing/output/wide_dat.csv")
```

## Create functions

Here, we create functions for:

  * Calculating cut-off values using either mean + 2SD or mean - 2SD
  * Calculating whether individuals recover from a drop in a test
  * Fit a cox regression based on thirtile_years or thirtile_PGS
  * Plot the survival curve for the cox regression
  * Test model assumptions for the cox regression

```{r, echo=FALSE}
# Calculates cut-off values using mean + 2SD of control (cognitively normal) at baseline
calc_pos_cvalue <- function(variable) {
  var_bl <- paste0(deparse(substitute(variable)), "_0")
  
  value <- wide_dat %>%
    filter(DX_0 == "CN") %>%
    summarize(
      {{ variable }} := mean(.[[ var_bl ]], na.rm = TRUE) + 2 * sd(.[[ var_bl ]], na.rm = TRUE)
    ) %>%
    pull({{ variable }})  # Extract the calculated value
    
  return(value)
}

# Calculates cut-off values using mean - 2SD of control (cognitively normal) at baseline
calc_neg_cvalue <- function(variable) {
  var_bl <- paste0(deparse(substitute(variable)), "_0")
  
  value <- wide_dat %>%
    filter(DX_0 == "CN") %>%
    summarize(
      {{ variable }} := mean(.[[ var_bl ]], na.rm = TRUE) - 2 * sd(.[[ var_bl ]], na.rm = TRUE)
    ) %>%
    pull({{ variable }})  # Extract the calculated value
    
  return(value)
}

# Calculates the time dependent and independent recovery for each participant (do they recover from a drop in a cognitive test)
filter_data <- function(outcome_var){
  cox_filtered_dat <- cox_filtered_dat %>%
    group_by(RID) %>%
    mutate(tRecovery = ifelse(lag({{outcome_var}} == 1) & {{outcome_var}} == 0, 1, 0),
           tRecovery = ifelse(is.na(tRecovery),0,tRecovery),
           ntRecovery = ifelse(any(tRecovery == 1),1,0),)%>%
    filter(ntRecovery==0) %>%
    relocate({{outcome_var}}, .before=tRecovery)
}

# Fits a Cox Hazards model on a data frame using thirtile PGS as a main predictor
fit_coxph_PGS <- function(event, filtered_data_frame=cox_filtered_dat){
  coxph(Surv(tstart, tstop, get(event)) ~ thirtile_PGS+age+sqrt(age)+PTGENDER+age*PTGENDER, # Polygenic Risk Score EA
                 data = filtered_data_frame)
}

# Fits a Cox Hazards model on a data frame using thirtile years as a main predictor
fit_coxph_years <- function(event, filtered_data_frame=cox_filtered_dat){
  coxph(Surv(tstart, tstop, get(event)) ~ thirtile_years+age+sqrt(age)+PTGENDER+age*PTGENDER, # Years in education
                 data = filtered_data_frame)
}

# Plots the survival curve of a Cox Hazards model for the PGS model
plot_coxph_PGS <- function(coxph_model){
  pgs_df<- with(cox_filtered_dat,
  data.frame(
  thirtile_PGS = c("Low PGS","Medium PGS","High PGS"),
  age = rep(mean(cox_filtered_dat$age), 3),
  PTGENDER = c("Male","Male","Male"))
  )
  
  ggsurvplot(
    survfit(coxph_model, newdata = pgs_df),
    data = cox_filtered_dat,
    legend.labs = c("Low PGS","Medium PGS","High PGS"),
    ggtheme = theme_minimal() +
      theme(
        panel.grid.major = element_line(color = "gray"),
        panel.grid.minor = element_line(color = "gray", size = 0.2)
      ),
    title = "Survival Curve (~ PGS + AGE + GENDER + AGExGENDER)", # Need to change title
    xlab = "Time",
    ylab = "Survival Probability",
    xlim = c(1.5, 11),
    palette = c("#021636", "#bbceed", "#0a77f5"),
    conf.int = FALSE  # Show confidence intervals
  )
}

# Plots the survival curve of a Cox Hazards model for the years model
plot_coxph_years <- function(coxph_model){
  pgs_df<- with(cox_filtered_dat,
  data.frame(
  thirtile_years = c("Low EA","Medium EA","High EA"),
  age = rep(mean(cox_filtered_dat$age), 3),
  PTGENDER = c("Male","Male","Male"))
  )
  
  ggsurvplot(
    survfit(coxph_model, newdata = pgs_df),
    data = cox_filtered_dat,
    legend.labs = c("Low EA","Medium EA","High EA"),
    ggtheme = theme_minimal() +
      theme(
        panel.grid.major = element_line(color = "gray"),
        panel.grid.minor = element_line(color = "gray", size = 0.2)
      ),
    title = "Survival Curve (~ years + AGE + GENDER + AGExGENDER)", # Need to change title
    xlab = "Time",
    ylab = "Survival Probability",
    xlim = c(1.5, 11),
    palette = c("#021636", "#bbceed", "#0a77f5"),
    conf.int = FALSE  # Show confidence intervals
  )
}

# Tests model assumption for the model
test_coxph <- function(coxph_model){
  # Testing Proportional Hazards
  test.ph <- cox.zph(coxph_model)
  test.ph
  ggcoxzph(test.ph)
  
  # Testing Outliers & Influential Cases
  ggcoxdiagnostics(coxph_model,
                   type = "dfbeta",
                   linear.predictions = FALSE,
                   ggtheme=theme_bw())
}
```

# Survival Analysis

Using the ntile function from dplyr, the lower tertile will be assigned value 1 (\~ negative residual), middle tertile value 2 and upper tertile value 3 (\~positive residual). The time-point is limited to the 9th follow-up (i.e., 48 months).

```{r, echo=FALSE}
# Divide the standardized residuals into upper, middle and lower quartile
wide_dat$thirtile_res <- ntile(wide_dat$res, 3)

boxplot(wide_dat$res ~ wide_dat$thirtile_res,
        xlab = "Thirtile of Residual Scores",
        ylab = "Residuals",
        main = "Check overlap between Thirtiles")

hist(wide_dat$PTEDUCAT, 
     xlab = "Education in Years",
     ylab = "Frequency",
     main = "Histogram of Education Distribution")

# Divide the standardized residuals into upper, middle and lower quartile
wide_dat$thirtile_years <- ntile(wide_dat$PTEDUCAT, 3)

# Divide the PGS score for educational attainment into upper, middle and lower quartile
wide_dat$thirtile_PGS <- ntile(wide_dat$EA22, 3)

wide_dat_sub <- wide_dat[, c("RID", "thirtile_res", "res", "thirtile_years", "thirtile_PGS")]

# Merge Thirtile and residuals in long data format based on RID
long_dat <- merge(wide_dat_sub, long_dat, by="RID", all.y=TRUE)
```

# Mini-Mental State Examination (MMSE)

"The mini--mental state examination (MMSE) is a 30-point questionnaire that is used extensively in clinical and research settings to measure cognitive impairment. It is commonly used in medicine and allied health to screen for dementia. It is also used to estimate the severity and progression of cognitive impairment and to follow the course of cognitive changes in an individual over time; thus making it an effective way to document an individual's response to treatment.Administration of the test takes between 5 and 10 minutes and examines functions including registration (repeating named prompts), attention and calculation, recall, language, ability to follow simple commands and orientation. [...] Any score of 24 or more (out of 30) indicates a normal cognition. Below this, scores can indicate severe (≤9 points), moderate (10--18 points) or mild (19-23 points) cognitive impairment." (Wikipedia.org). The MMSE scores were normalized using the NormPsy package and then the cut-off was calculated.

```{r, echo=FALSE}
cvalue <- list() # initialize list of cut-off values

long_dat$MMSE_norm <- normMMSE(long_dat$MMSE) # normalize MMSE

cvalue$MMSE_norm <- wide_dat %>% # Calculate cut-off value for normalized MMSE
    filter(DX_0 == "CN") %>%
    summarize(
      value := mean(normMMSE(MMSE_0), na.rm = TRUE) - 2 * sd(normMMSE(MMSE_0), na.rm = TRUE)
    ) %>%
    pull(value)

long_dat$MMSE_cut <- ifelse(long_dat$MMSE_norm < cvalue$MMSE_norm, 1, 0) # Group individuals by cut-off value

```


## Boxplots of MMSE by Age Group at Baseline

To see if it is necessary to stratify for age groups effect of polygenic risk score for EA and age group was tested using linear regression. The results are displayed below.

```{r, echo=FALSE, warning=FALSE}
filtered_long_dat <- long_dat %>% #filter out NA cases (== AGE is not between 60-75)
  filter(!is.na(Age_Group), VISCODE==0)

# Boxplot for MMSE by Age Group
box1 <- ggplot(filtered_long_dat, aes(x = factor(Age_Group), y = MMSE)) +
  geom_boxplot(fill = c("#6d8fa6", "#8596a1","#bbceed"), color = "black") + # Set fill and border colours
  scale_x_discrete(labels = c("60-65", "66-70", "71-75")) + # Set x axis scale labels
  labs(x = "Age Group", y = "MMSE Score") +
  theme_minimal() +
  theme(axis.line = element_line(size = 0.5),
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Adjust title
        axis.title = element_text(size = 12),  # Adjust axis title font size
        axis.text = element_text(size = 10),   # Adjust axis text font size
        panel.grid.major = element_blank(),     # Remove major grid lines
        panel.grid.minor = element_blank()) +   # Remove minor grid lines
  ggtitle("Boxplot of raw MMSE at baseline by Age Group") +
  theme(plot.title = element_text(size = 9)) # Custom title     # Custom title


# Boxplot for normMMSE by Age Group
box2 <- ggplot(filtered_long_dat, aes(x = factor(Age_Group), y = MMSE_norm)) +
  geom_boxplot(fill = c("#6d8fa6", "#8596a1","#bbceed"), color = "black") + # Set fill and border colours
  scale_x_discrete(labels = c("60-65", "66-70", "71-75")) + # Set x axis scale labels
  labs(x = "Age Group", y = "MMSE Score") +
  theme_minimal() +
  theme(axis.line = element_line(size = 0.5),
        plot.title = element_text(hjust = 0.5, face = "bold", size = 14),  # Adjust title
        axis.title = element_text(size = 12),  # Adjust axis title font size
        axis.text = element_text(size = 10),   # Adjust axis text font size
        panel.grid.major = element_blank(),     # Remove major grid lines
        panel.grid.minor = element_blank()) +   # Remove minor grid lines
  ggtitle("Boxplot of norm MMSE at baseline by Age Group") +
  theme(plot.title = element_text(size = 9)) # Custom title

res <- lm(MMSE ~ EA22 + Age_Group, data = long_dat)
res2 <- lm(MMSE_norm ~ EA22 + Age_Group, data = long_dat)

grid.arrange(box1, box2, ncol = 2)
summary(res)
summary(res2)

rm(filtered_long_dat, box1, box2, res, res2, wide_dat_sub)
```

# MMSE Survival Analysis

Next the survival analysis was conducted for the genetic capacity of educational attainment and the years of actual educational attainment.

## Data Filtering

We created "age" as a time-dependent variable as well as "tstart" and "tstop".

```{r, echo=FALSE}
months <- c("bl", "m03", "m06", "m12", "m18", "m24", 
                                    "m30","m36", "m42", "m48", "m54", "m60", 
                                    "m66", "m72","m78", "m84", "m90", "m96", 
                                    "m102", "m108","m114", "m120", "m126", 
                                    "m132", "m144", "m156")

time_points <- data.frame(Time = seq(0,27),
                          Months = c(0,3,6,12,seq(from = 18, to = 156, by = 6)))

################################################################################
# Filter & Time dependent Age & Calculate tstart and tstop
################################################################################

cox_filtered_dat <- long_dat %>% # filter the data 
  filter(VISCODE <= 9, AGE >= 60, AGE <= 75) %>%
  arrange(RID, VISCODE) %>%
  mutate(GENDER = ifelse(PTGENDER== "Male", 0,1), # Calculate numerical Gender variable
         VISCODE = VISCODE + 1,
         thirtile_PGS = case_when(
           thirtile_PGS == 1 ~ "Low PGS",
           thirtile_PGS == 2 ~ "Medium PGS",
           thirtile_PGS == 3 ~ "High PGS", 
           TRUE ~ as.character(thirtile_PGS)),
         thirtile_years = case_when(
           thirtile_years == 1 ~ "Low EA",
           thirtile_years == 2 ~ "Medium EA",
           thirtile_years == 3 ~ "High EA", 
           TRUE ~ as.character(thirtile_years)),
         age = AGE+(time_points$Months[match(.$VISCODE, time_points$Time)])/12,) %>%
  relocate(age, .before=AGE) %>%
  group_by(RID) %>%
  mutate(tstart = ifelse(VISCODE == 1,0,lag(VISCODE)),
         tstop = ifelse(VISCODE != 1, VISCODE,1)) %>%
  arrange(RID, VISCODE) %>%
  relocate(c(VISCODE,tstart,tstop), .before = thirtile_res)


################################################################################
# Set Variables Types
################################################################################

cox_filtered_dat <- cox_filtered_dat %>%
  mutate(thirtile_PGS= as.factor(thirtile_PGS),
         thirtile_years= as.factor(thirtile_years),
         AGE = as.numeric(AGE),
         age = as.numeric(age),
         GENDER = as.factor(GENDER),
         PTGENDER = as.factor(PTGENDER)) 
```

## Descriptive Statistics

The following output shows:

  1. the number of individuals overall
  2. the number of unique individuals in the analysis
  3. the number of males/females in the analysis
  4. the number of individuals per time-point

```{r, echo=FALSE}
length(unique(long_dat$RID)) # Number of individuals overall

length(unique(cox_filtered_dat$RID)) # Number of unique individuals in the analysis

print(gender_counts <- cox_filtered_dat %>% # Number of Males/Females in Sample
  distinct(RID, .keep_all = TRUE) %>%  
  group_by(PTGENDER) %>%
  summarize(Count = n()))


print(age_dist <- cox_filtered_dat %>% # Number of Individual by Time-point
  group_by(VISCODE) %>%
  summarize(Count = n()))
```
From now on, the reference for the regression model is:
  * "Medium PGS" for thirtile_PGS
  * "Medium EA" for thirtile_years

```{r, echo=FALSE}
################################################################################
# Set Reference Level of PGS & Years
################################################################################

cox_filtered_dat <- within(cox_filtered_dat,thirtile_PGS <- relevel(thirtile_PGS, ref="Medium PGS")) # Change the Reference Level of the PGS factor

cox_filtered_dat <- within(cox_filtered_dat,thirtile_years <- relevel(thirtile_years, ref="Medium EA")) # Change the Reference Level of the EA factor
```

Here is the output for the Cox Proportional Hazards model of MMSE

```{r, echo=FALSE, message=FALSE, warning=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("MMSE_cut")
res.cox.years <- fit_coxph_years("MMSE_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## Cox Assumptions

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Tests model assumptions
test_coxph(res.cox.PGS)

# Testing Non-Linearity
ggcoxfunctional(Surv(VISCODE, MMSE_cut) ~ age + sqrt(age) + log(age), data = cox_filtered_dat)
plot(residuals(res.cox.PGS))
```


# Alzheimer's Disease Assessment Scale

The Cognitive Subscale Alzheimer's Disease Assessment Scale (ADAS) is made of 11 tasks that include both subject-completed tests and observer-based assessments, assessing the memory, language, and praxis domains. The result is a global final score ranging from 0 to 70, based on the sum of the scores of the single tasks (ADAS11).

Beyond the ADAS11 score, the ADNI study included also an additional test of delayed word recall and a number cancellation or maze task, which are further summed to have a new total score that ranges from 0 to 85 (ADAS13).

In addition, the score of the task 4 (Word Recognition, ADASQ4) was included in the ADNIMERGE dataset.

([Grassi et al., 2019](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6646724/))

## ADAS11

```{r, echo=FALSE, message=FALSE}
cvalue$ADAS11 <- calc_pos_cvalue(ADAS11)

cox_filtered_dat$ADAS11_cut <- ifelse(cox_filtered_dat$ADAS11 > cvalue$ADAS11, 1, 0)

cox_filtered_dat <- filter_data(ADAS11_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("ADAS11_cut")
res.cox.years <- fit_coxph_years("ADAS11_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

### Cox Assumptions

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Tests model assumptions
test_coxph(res.cox.PGS)

# Testing Non-Linearity
ggcoxfunctional(Surv(VISCODE, ADAS11_cut) ~ age + sqrt(age) + log(age), data = cox_filtered_dat)
plot(residuals(res.cox.PGS))
```


## ADAS13

"The ADAS13 was included as a global measure of cognitive function. ADAS13 is a test battery developed to assess severity of cognitive impairment associated with AD and includes subtests and clinical evaluations assessing memory function, reasoning, language function, orientation and praxis. The ADAS13 is a modified version of the original ADAS-Cog-11, adding a cancellation task and a delayed free recall task. The higher the scores, the more severe impairment of cognitive function." (Mofrad et al., 2021)


```{r, echo=FALSE, message=FALSE}
cvalue$ADAS13 <- calc_pos_cvalue(ADAS13)

cox_filtered_dat$ADAS13_cut <- ifelse(cox_filtered_dat$ADAS13 > cvalue$ADAS13, 1, 0)

cox_filtered_dat <- filter_data(ADAS13_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("ADAS13_cut")
res.cox.years <- fit_coxph_years("ADAS13_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

### Cox Assumptions

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Tests model assumptions
test_coxph(res.cox.PGS)

# Testing Non-Linearity
ggcoxfunctional(Surv(VISCODE, ADAS13_cut) ~ age + sqrt(age) + log(age), data = cox_filtered_dat)
plot(residuals(res.cox.PGS))
```

## ADASQ4


```{r, echo=FALSE, message=FALSE}
cvalue$ADASQ4 <- calc_pos_cvalue(ADASQ4)

cox_filtered_dat$ADASQ4_cut <- ifelse(cox_filtered_dat$ADASQ4 > cvalue$ADASQ4, 1, 0)

cox_filtered_dat <- filter_data(ADASQ4_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("ADASQ4_cut")
res.cox.years <- fit_coxph_years("ADASQ4_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

### Cox Assumptions

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Tests model assumptions
test_coxph(res.cox.PGS)

# Testing Non-Linearity
ggcoxfunctional(Surv(VISCODE, ADASQ4_cut) ~ age + sqrt(age) + log(age), data = cox_filtered_dat)
plot(residuals(res.cox.PGS))
```

# CDRSB

"The clinical dementia rating (CDR) scale is commonly used to diagnose dementia due to Alzheimer's disease (AD). The sum of boxes of the CDR (CDR-SB) has recently been emphasized and applied to interventional trials for tracing the progression of cognitive impairment (CI) in the early stages of AD." ([Tzeng et al., 2022](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9537043/))

See [Table 3](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3409562/table/T3/?report=objectonly) for explanation on the staging category ([O'Bryant et al., 2012](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3409562/))

```{r, echo=FALSE, message=FALSE}
cvalue$CDRSB <- calc_pos_cvalue(CDRSB)

cox_filtered_dat$CDRSB_cut <- ifelse(cox_filtered_dat$CDRSB > cvalue$CDRSB, 1, 0)

cox_filtered_dat <- filter_data(CDRSB_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("CDRSB_cut")
res.cox.years <- fit_coxph_years("CDRSB_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# DIGITSCORE

"The DSST (Digit Symbol Substitution Test) is a paper-and-pencil cognitive test presented on a single sheet of paper that requires a subject to match symbols to numbers according to a key located on the top of the page. The subject copies the symbol into spaces below a row of numbers. The number of correct symbols within the allowed time, usually 90 to 120 seconds, constitutes the score." ([Jaeger, 2018](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6291255/)) The lower the scores, the more severe impairment of cognitive function.

```{r, echo=FALSE, message=FALSE}
cvalue$DIGITSCOR <- calc_neg_cvalue(DIGITSCOR)

cox_filtered_dat$DIGITSCOR_cut <- ifelse(cox_filtered_dat$DIGITSCOR < cvalue$DIGITSCOR, 1, 0)

cox_filtered_dat <- filter_data(DIGITSCOR_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("DIGITSCOR_cut")
res.cox.years <- fit_coxph_years("DIGITSCOR_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# FAQ

The Functional Activities Questionnaire is used to assess an individual's functional abilities in daily living activities. It is a caregiver-based questionnaire that helps evaluate how well a person is able to perform various instrumental activities of daily living (IADLs) and basic activities of daily living (ADLs). (ChatGPT) Sum scores (range 0-30). The score range for each item is 0--3 (higher scores indicate greater impairment; 0 = normal or never did but could do now; 1 = has difficulty but does by self or never did but would have difficulty now; 2 = requires assistance; 3 = dependent). There is no established cut-off score for IADL impairment on the FAQ. However, one study reported that a total FAQ score (sum of all 10 item scores; range 0--30) of ≥ 6 is suggestive of functional impairment [ [20](https://pubmed.ncbi.nlm.nih.gov/15592138/)]. ([Marshall et al., 2015](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4448081/))

```{r, echo=FALSE, message=FALSE}
cvalue$FAQ <- 5

cox_filtered_dat$FAQ_cut <- ifelse(cox_filtered_dat$FAQ > cvalue$FAQ, 1, 0)

cox_filtered_dat <- filter_data(FAQ_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("FAQ_cut")
res.cox.years <- fit_coxph_years("FAQ_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# LDELTOTAL

```{r, echo=FALSE, message=FALSE}
cvalue$LDELTOTAL <- calc_neg_cvalue(LDELTOTAL)

cox_filtered_dat$LDELTOTAL_cut <- ifelse(cox_filtered_dat$LDELTOTAL < cvalue$LDELTOTAL, 1, 0)

cox_filtered_dat <- filter_data(LDELTOTAL_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("LDELTOTAL_cut")
res.cox.years <- fit_coxph_years("LDELTOTAL_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# MOCA

Reference literature: doi: 10.1111/j.1532-5415.2005.53221.x

```{r, echo=FALSE, message=FALSE}
cox_filtered_dat$MOCA_cut <- ifelse(cox_filtered_dat$MOCA < 26, 1, 0)

cox_filtered_dat <- filter_data(MOCA_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("MOCA_cut")
res.cox.years <- fit_coxph_years("MOCA_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# Rey-Auditory Verbal Learning Test (RAVLT)

The RAVLT was included as a measure of memory function. In this test, the participants are asked to recall words from a list of 15 nouns immediately after each of five learning trials and after a short and a long delay. Two measures known to be sensitive to cognitive changes in patients with AD were included in the present study: Immediate recall (RAVLT-Im): the number of correct responses across the immediate recall of the five learning trials; percent forgetting (RAVLT-PF): the score on the fifth learning trial minus the score on the long delayed recall, divided by the score obtained on the fifth learning trial. The lower the scores, the more severe impairment of cognitive function.

Different summary scores are derived from raw RAVLT scores. These include RAVLT Immediate (the sum of scores from 5 first trials (Trials 1 to 5)), RAVLT Learning (the score of Trial 5 minus the score of Trial 1), RAVLT Forgetting (the score of Trial 5 minus score of the delayed recall) and RAVLT Percent Forgetting (RAVLT Forgetting divided by the score of Trial 5). We use naming of the ADNI merge table3 for these summary measures. We investigated the relationship between MRI measures and RAVLT cognitive test scores by estimating the RAVLT Immediate and RAVLT Percent Forgetting from the gray matter density. These two summary scores were selected since they highlight different aspects of episodic memory, learning (RAVLT Immediate) and delayed memory (RAVLT Percent forgetting), essential to AD and previous studies (Estévez-González et al., 2003, Wang et al., 2011, Gomar et al., 2014, Moradi et al., 2015) have indicated strong relationships between these two RAVLT measures and Alzheimer's disease.

## RAVLT Immediate

```{r, echo=FALSE, message=FALSE}
cvalue$RAVLT_immediate <- calc_neg_cvalue(RAVLT_immediate)

cox_filtered_dat$RAVLT_immediate_cut <- ifelse(cox_filtered_dat$RAVLT_immediate < cvalue$RAVLT_immediate, 1, 0)

cox_filtered_dat <- filter_data(RAVLT_immediate_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("RAVLT_immediate_cut")
res.cox.years <- fit_coxph_years("RAVLT_immediate_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## RAVLT Percentage Forgetting

```{r, echo=FALSE, message=FALSE}
cvalue$RAVLT_perc_forgetting <- calc_pos_cvalue(RAVLT_perc_forgetting)

cox_filtered_dat$RAVLT_perc_forgetting_cut <- ifelse(cox_filtered_dat$RAVLT_perc_forgetting > cvalue$RAVLT_perc_forgetting, 1, 0)

cox_filtered_dat <- filter_data(RAVLT_perc_forgetting_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("RAVLT_perc_forgetting_cut")
res.cox.years <- fit_coxph_years("RAVLT_perc_forgetting_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## RAVLT Forgetting

```{r, echo=FALSE, message=FALSE}
cvalue$RAVLT_forgetting <- calc_pos_cvalue(RAVLT_forgetting)

cox_filtered_dat$RAVLT_forgetting_cut <- ifelse(cox_filtered_dat$RAVLT_forgetting > cvalue$RAVLT_forgetting, 1, 0)

cox_filtered_dat <- filter_data(RAVLT_forgetting_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("RAVLT_forgetting_cut")
res.cox.years <- fit_coxph_years("RAVLT_forgetting_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## RAVLT Learning

```{r, echo=FALSE, message=FALSE}
cvalue$RAVLT_learning <- calc_pos_cvalue(RAVLT_learning)

cox_filtered_dat$RAVLT_learning_cut <- ifelse(cox_filtered_dat$RAVLT_learning > cvalue$RAVLT_learning, 1, 0)

cox_filtered_dat <- filter_data(RAVLT_learning_cut)
```

```{r, eval=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("RAVLT_learning_cut")
res.cox.years <- fit_coxph_years("RAVLT_learning_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# TRABSCORE

The Trail Making Test is a neuropsychological test of visual attention and task switching. It has two parts, in which the subject is instructed to connect a set of 25 dots as quickly as possible while maintaining accuracy.

The test can provide information about visual search speed, scanning, speed of processing, mental flexibility, and executive functioning. It is sensitive to cognitive impairment associated with dementia, including Alzheimer's disease. (ChatGPT)

Record the total number of seconds to complete Part B (*Trails B*), up to a maximum of 300 seconds. If the participant is not finished by 300 seconds, the score is 300.

```{r, echo=FALSE, message=FALSE}
cvalue$TRABSCOR <- calc_pos_cvalue(TRABSCOR)

cox_filtered_dat$TRABSCOR_cut <- ifelse(cox_filtered_dat$TRABSCOR > cvalue$TRABSCOR, 1, 0)

cox_filtered_dat <- filter_data(TRABSCOR_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("TRABSCOR_cut")
res.cox.years <- fit_coxph_years("TRABSCOR_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# Patient's Everyday Cognition (EcogPt)

The original version of the ECog is an informant-based measure of cognitively-relevant everyday abilities comprised of 39 items, covering six cognitively-relevant domains: Everyday Memory, Everyday Language, Everyday Visuospatial Abilities, and Everyday Planning, Everyday Organization, and Everyday Divided Attention. Ratings are made on a four-point scale: 1 = better or no change compared to 10 years earlier, 2 = questionable/occasionally worse, 3 = consistently a little worse, 4 = consistently much worse. ([Tomaszewski Farias et al., 2012](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3211103/))

## EcogPt Everyday Divided Attention

```{r, echo=FALSE, message=FALSE}
cvalue$EcogPtDivatt <- calc_pos_cvalue(EcogPtDivatt)

cox_filtered_dat$EcogPtDivatt_cut <- ifelse(cox_filtered_dat$EcogPtDivatt > cvalue$EcogPtDivatt, 1, 0)

cox_filtered_dat <- filter_data(EcogPtDivatt_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtDivatt_cut")
res.cox.years <- fit_coxph_years("EcogPtDivatt_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Everyday Language

```{r, echo=FALSE}
cvalue$EcogPtLang <- calc_pos_cvalue(EcogPtLang)

cox_filtered_dat$EcogPtLang_cut <- ifelse(cox_filtered_dat$EcogPtLang > cvalue$EcogPtLang, 1, 0)

cox_filtered_dat <- filter_data(EcogPtLang_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtLang_cut")
res.cox.years <- fit_coxph_years("EcogPtLang_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Everyday Memory

```{r, echo=FALSE}
cvalue$EcogPtMem <- calc_pos_cvalue(EcogPtMem)

cox_filtered_dat$EcogPtMem_cut <- ifelse(cox_filtered_dat$EcogPtMem > cvalue$EcogPtMem, 1, 0)

cox_filtered_dat <- filter_data(EcogPtMem_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtMem_cut")
res.cox.years <- fit_coxph_years("EcogPtMem_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Everyday Organization

```{r, echo=FALSE}
cvalue$EcogPtOrgan <- calc_pos_cvalue(EcogPtOrgan)

cox_filtered_dat$EcogPtOrgan_cut <- ifelse(cox_filtered_dat$EcogPtOrgan > cvalue$EcogPtOrgan, 1, 0)

cox_filtered_dat <- filter_data(EcogPtOrgan_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtOrgan_cut")
res.cox.years <- fit_coxph_years("EcogPtOrgan_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Everyday Planning

```{r, echo=FALSE}
cvalue$EcogPtPlan <- calc_pos_cvalue(EcogPtPlan)

cox_filtered_dat$EcogPtPlan_cut <- ifelse(cox_filtered_dat$EcogPtPlan > cvalue$EcogPtPlan, 1, 0)

cox_filtered_dat <- filter_data(EcogPtPlan_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtPlan_cut")
res.cox.years <- fit_coxph_years("EcogPtPlan_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Everyday Visuospatial Abilities

```{r, echo=FALSE}
cvalue$EcogPtVisspat <- calc_pos_cvalue(EcogPtVisspat)

cox_filtered_dat$EcogPtVisspat_cut <- ifelse(cox_filtered_dat$EcogPtVisspat > cvalue$EcogPtVisspat, 1, 0)

cox_filtered_dat <- filter_data(EcogPtVisspat_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtVisspat_cut")
res.cox.years <- fit_coxph_years("EcogPtVisspat_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogPt Total

```{r, echo=FALSE}
cvalue$EcogPtTotal <- calc_pos_cvalue(EcogPtTotal)

cox_filtered_dat$EcogPtTotal_cut <- ifelse(cox_filtered_dat$EcogPtTotal > cvalue$EcogPtTotal, 1, 0)

cox_filtered_dat <- filter_data(EcogPtTotal_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogPtTotal_cut")
res.cox.years <- fit_coxph_years("EcogPtTotal_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# Self-Reported Everyday Cognitive Abilities Questionnaire (EcogSP)

## EcogSP Everyday Divided Attention

```{r, echo=FALSE}
cvalue$EcogSPDivatt <- calc_pos_cvalue(EcogSPDivatt)

cox_filtered_dat$EcogSPDivatt_cut <- ifelse(cox_filtered_dat$EcogSPDivatt > cvalue$EcogSPDivatt, 1, 0)

cox_filtered_dat <- filter_data(EcogSPDivatt_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPDivatt_cut")
res.cox.years <- fit_coxph_years("EcogSPDivatt_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Everyday Language

```{r, echo=FALSE}
cvalue$EcogSPLang <- calc_pos_cvalue(EcogSPLang)

cox_filtered_dat$EcogSPLang_cut <- ifelse(cox_filtered_dat$EcogSPLang > cvalue$EcogSPLang, 1, 0)

cox_filtered_dat <- filter_data(EcogSPLang_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPLang_cut")
res.cox.years <- fit_coxph_years("EcogSPLang_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Everyday Memory

```{r, echo=FALSE}
cvalue$EcogSPMem <- calc_pos_cvalue(EcogSPMem)

cox_filtered_dat$EcogSPMem_cut <- ifelse(cox_filtered_dat$EcogSPMem > cvalue$EcogSPMem, 1, 0)

cox_filtered_dat <- filter_data(EcogSPMem_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPMem_cut")
res.cox.years <- fit_coxph_years("EcogSPMem_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Everyday Organization

```{r, echo=FALSE}
cvalue$EcogSPOrgan <- calc_pos_cvalue(EcogSPOrgan)

cox_filtered_dat$EcogSPOrgan_cut <- ifelse(cox_filtered_dat$EcogSPOrgan > cvalue$EcogSPOrgan, 1, 0)

cox_filtered_dat <- filter_data(EcogSPOrgan_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPOrgan_cut")
res.cox.years <- fit_coxph_years("EcogSPOrgan_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Everyday Planning

```{r, echo=FALSE}
cvalue$EcogSPPlan <- calc_pos_cvalue(EcogSPPlan)

cox_filtered_dat$EcogSPPlan_cut <- ifelse(cox_filtered_dat$EcogSPPlan > cvalue$EcogSPPlan, 1, 0)

cox_filtered_dat <- filter_data(EcogSPPlan_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPPlan_cut")
res.cox.years <- fit_coxph_years("EcogSPPlan_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Everyday Visuospatial Abilities

```{r, echo=FALSE, message=FALSE}
cvalue$EcogSPVisspat <- calc_pos_cvalue(EcogSPVisspat)

cox_filtered_dat$EcogSPVisspat_cut <- ifelse(cox_filtered_dat$EcogSPVisspat > cvalue$EcogSPVisspat, 1, 0)

cox_filtered_dat <- filter_data(EcogSPVisspat_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPVisspat_cut")
res.cox.years <- fit_coxph_years("EcogSPVisspat_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

## EcogSP Total

```{r, echo=FALSE}
cvalue$EcogSPTotal <- calc_pos_cvalue(EcogSPTotal)

cox_filtered_dat$EcogSPTotal_cut <- ifelse(cox_filtered_dat$EcogSPTotal > cvalue$EcogSPTotal, 1, 0)

cox_filtered_dat <- filter_data(EcogSPTotal_cut)
```

```{r, echo=FALSE, message=FALSE}
################################################################################
# Run Cox Proportional Hazards Model & Plot
################################################################################

# Creates Cox Proportional Hazards regression model
res.cox.PGS <- fit_coxph_PGS("EcogSPTotal_cut")
res.cox.years <- fit_coxph_years("EcogSPTotal_cut")

# Results of Models
summary(res.cox.PGS)
summary(res.cox.years)

# Plots the Cox model
plot_coxph_PGS(res.cox.PGS)
plot_coxph_years(res.cox.years)
```

# Print session info:

```{r print_session_info}
##Print session info:
sessionInfo()
```